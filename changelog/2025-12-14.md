# 2025-12-14 变更记录

## 已完成

- **Zustand Store 健壮性与一致性**
  - `importFiles()` 使用 `try/finally` 保证 `importing` 状态正确恢复。
  - 去重逻辑修正：缺失 `addDate/lastModified` 的书签不再错误地被优先保留；`duplicates` 中第 1 条始终为“保留项”。
  - `loadFromDB()` 恢复数据时同步初始化 `rawItems`，避免恢复后统计/合并逻辑不一致。
  - 新增 `needsMerge` 脏状态：导入新文件后置 `true`，合并/从 DB 恢复/清空后置 `false`，用于阻止“导出旧结果”。
  - `clear()` 升级为异步：清空内存状态、重置搜索索引，并清理 IndexedDB 中的书签数据。

- **搜索模块类型化与可重置**
  - 新增 `SearchResultItem` 类型，`search()` 返回强类型结果。
  - 新增 `resetSearchIndex()`，用于清空/重建数据后避免旧索引残留。

- **IndexedDB 清理能力**
  - `db.ts` 新增 `clearBookmarks()`，用于清空 `bookmarks` 表。

- **UI/交互修复与性能优化**
  - 上传页导出按钮逻辑优化：从 DB 恢复数据后可直接导出；导入新文件后触发 `needsMerge` 并展示提示，必须重新“合并去重”后才能导出。
  - ECharts 组件生命周期优化：避免每次渲染重复 `init()`，减少闪烁并提升性能。
  - 搜索页移除 `any`，结果列表使用 `SearchResultItem[]`。

## 备注

- IDE 提示的 “找不到模块 react/dexie/minisearch/echarts 等” 多数是本机依赖未安装或 TS 语言服务未加载 `node_modules` 导致；待执行 `npm install` 后再以 `npm run typecheck` / `npm run build` 验证。
